= Docker stuff

== Docker Toolbox

I'm using Docker Toolbox (https://www.docker.com/products/docker-toolbox)

----
docker-machine create --driver virtualbox default
docker-machine ls

docker-machine start default
docker-machine env default

docker-machine ip
docker-machine ssh
----

SCP/FTP/SFTP : `docker/tcuser`

== Docker Compose

Check configuration

 $ docker-compose config
 
(Force) rebuild

 $ docker-compose up -d
 $ docker-compose up -d --build

Check process

 $ docker-compose ps

== Docker commands

https://docs.docker.com/engine/reference/commandline/cli/

[%header,cols="3, 1"]
|===
| Command
| Description

| `docker container ls`
| list containers

| `docker container ls -a --format 'table {{.ID}}\t{{.Image}}\t{{.Names}}\t{{.Status}}'`
| list containers

| `docker ps -a`
| to be deprecated

| `docker container logs -f [container_name]`
| show log

| `docker exec -it [container_name] bash`
| execute command

| `docker image ls`
| list images

| `docker images`
| list images (to be deprecated)

| `docker image prune -f`
| clean images

| `docker rmi $(docker images --quiet --filter "dangling=true")`
| clean images

| `docker volumes ls`
| list docker volumes

| `docker system prune [--volumes]`
| clean stopped container

| `docker rm $(docker ps -a --format '{{.ID}}' --filter 'exited=0')`
| clean stopped container

| `docker stats`
| resources usage
|===

 docker container ls -q | xargs docker stats

 $ docker-machine ssh
 $ docker@default:~$ sudo -i
 $ ls -l /mnt/sda1/var/lib/docker/volumes/

== Dockerfile tips

=== Non root user

----
RUN groupadd -r myuser
RUN useradd -m -r -g myuser myuser
USER myuser
----

=== Size does matter

* use alpine base image
* remove any unused downloaded archives
